apply plugin: "scala"
apply plugin: "idea"
apply plugin: "maven"

version = "0.1"
group = "org.expecty"

repositories {
  mavenCentral()
  maven { url "https://oss.sonatype.org/content/repositories/snapshots" }
}

dependencies {
  scalaTools "org.scala-lang:scala-compiler:2.10.0-M3"

  compile "org.scala-lang:scala-compiler:2.10.0-M3"
  compile "org.scala-lang:scala-library:2.10.0-M3"

  testCompile "junit:junit:4.10"
}

compileScala {  
  scalaCompileOptions.with {
    additionalParameters = ["-Xmacros"]
    //additionalParameters += ["-Ymacro-debug", "-Ymacro-copypaste"]
  }
}

compileTestScala {
  // compiler doesn't seem to like scripts
  exclude "**/ExpectyExample.scala"

  scalaCompileOptions.with {
    //loggingLevel = "debug"
    //loggingPhases = ["namer", "typer", "pickler", "explicitouter", "lambdalift"]
    additionalParameters = ["-Yrangepos"]
    //additionalParameters += ["-Ylog:icode", "-Ydebug"]
    //additionalParameters += ["-verbose"]
    //useCompileDaemon=true
  }
}

uploadArchives {
  repositories.mavenDeployer {
    repository url: "file:///${projectDir}/m2repo"
    pom.whenConfigured {
      it.dependencies.find { it.artifactId == "scala-compiler" }.scope = "provided"
    }
  }
}

idea {
  project {
    jdkName = "1.6"
  }
}

test {
  testLogging.showStandardStreams = true
}

task wrapper(type: Wrapper) {
  gradleVersion = "1.0-rc-3"
}

